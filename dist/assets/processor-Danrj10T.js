(function(){"use strict";class l extends AudioWorkletProcessor{buffer;bufferIndex=0;threshold=.1;constructor(r){super();const e=r?.processorOptions?.bufferSize||2048;this.buffer=new Float32Array(e),this.threshold=r?.processorOptions?.threshold||.1}process(r,e,s){const u=r[0];if(!u||!u.length)return!0;const o=u[0];for(let t=0;t<o.length;t++)this.buffer[this.bufferIndex]=o[t],this.bufferIndex++,this.bufferIndex>=this.buffer.length&&(this.bufferIndex=0,this.detectPitch());return!0}detectPitch(){const r=this.buffer,e=r.length,s=new Float32Array(e/2);for(let t=0;t<e/2;t++){s[t]=0;for(let i=0;i<e/2;i++){const f=r[i]-r[i+t];s[t]+=f*f}}s[0]=1;let u=0;for(let t=1;t<e/2;t++)u+=s[t],s[t]*=t/u;let o=-1;for(let t=2;t<e/2;t++)if(s[t]<this.threshold){for(;t+1<e/2&&s[t+1]<s[t];)t++;o=t;break}if(o!==-1){let t=o;if(o>0&&o<e/2-1){const n=s[o-1],b=s[o],c=s[o+1];let h=(c-n)/(2*(2*b-c-n));h=Math.min(Math.max(h,-.5),.5),t+=h}const i=sampleRate/t;let f=0;for(let n=0;n<e;n++)f+=r[n]*r[n];const a=Math.sqrt(f/e);this.port.postMessage({pitch:i,clarity:1-s[o],bufferrms:a})}else{let t=0;for(let f=0;f<e;f++)t+=r[f]*r[f];const i=Math.sqrt(t/e);this.port.postMessage({pitch:null,clarity:0,bufferrms:i})}}}registerProcessor("pitch-processor",l)})();
