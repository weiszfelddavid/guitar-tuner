(function(){"use strict";class h extends AudioWorkletProcessor{buffer;bufferIndex=0;threshold=.1;constructor(r){super();const e=r?.processorOptions?.bufferSize||2048;this.buffer=new Float32Array(e),this.threshold=r?.processorOptions?.threshold||.1}process(r,e,s){const u=r[0];if(!u||!u.length)return!0;const i=u[0];for(let t=0;t<i.length;t++)this.buffer[this.bufferIndex]=i[t],this.bufferIndex++,this.bufferIndex>=this.buffer.length&&(this.bufferIndex=0,this.detectPitch());return!0}detectPitch(){const r=this.buffer,e=r.length,s=new Float32Array(e/2);for(let t=0;t<e/2;t++){s[t]=0;for(let f=0;f<e/2;f++){const o=r[f]-r[f+t];s[t]+=o*o}}s[0]=1;let u=0;for(let t=1;t<e/2;t++)u+=s[t],s[t]*=t/u;let i=-1;for(let t=2;t<e/2;t++)if(s[t]<this.threshold){for(;t+1<e/2&&s[t+1]<s[t];)t++;i=t;break}if(i!==-1){const t=44100/i;let f=0;for(let n=0;n<e;n++)f+=r[n]*r[n];const o=Math.sqrt(f/e);this.port.postMessage({pitch:t,clarity:1-s[i],bufferrms:o})}else{let t=0;for(let o=0;o<e;o++)t+=r[o]*r[o];const f=Math.sqrt(t/e);this.port.postMessage({pitch:null,clarity:0,bufferrms:f})}}}registerProcessor("pitch-processor",h)})();
