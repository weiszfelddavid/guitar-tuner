# Caddy configuration for Pure Tone Guitar Tuner
# Serves the application with required security headers for WASM/AudioWorklet

tuner.weiszfeld.com {
    # Serve files from the deployment directory
    root * /var/www/tuner
    file_server

    # Required security headers for WASM in AudioWorklets
    # These enable SharedArrayBuffer and cross-origin isolation
    header {
        Cross-Origin-Opener-Policy "same-origin"
        Cross-Origin-Embedder-Policy "require-corp"
    }

    # Serve WASM files with correct MIME type
    @wasm {
        path *.wasm
    }
    header @wasm Content-Type "application/wasm"
    header @wasm Cross-Origin-Resource-Policy "same-origin"

    # Serve JavaScript files (including worklets) with CORP header
    @js {
        path *.js *.mjs
    }
    header @js Cross-Origin-Resource-Policy "same-origin"

    # Enable gzip compression for better performance
    encode gzip

    # Single Page Application: serve index.html for all non-file routes
    try_files {path} /index.html
}
